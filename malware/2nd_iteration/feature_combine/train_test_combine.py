# -*- coding: utf-8 -*-

import pandas as pd
import numpy as np

def convertTestFilesToTrainFeaturesSpace(csvTrain, csvTest):

    dfTrain = pd.read_csv(csvTrain)
    dfTest = pd.read_csv(csvTest)
    
    return convertTestDataFramesToTrainFeaturesSpace(dfTrain, dfTest)


def convertTestDataFramesToTrainFeaturesSpace(dfTrain, dfTest):
    
    # remove first and last columns ('id', 'category')
    trainColumns = dfTrain.columns.values[1:-1] 
    testColumns = dfTest.columns.values[1:-1]
    
    # get Set to use relational algebra operations
    trainColsSet = set(trainColumns) 
    testColsSet = set(testColumns)
    
    # Operations
    columnsIntersection = trainColsSet & testColsSet
    colsToKeep = trainColsSet - testColsSet | columnsIntersection
    
    # Rebuild Dataframe
    df = pd.DataFrame(index=[], columns=colsToKeep)
    for colName in columnsIntersection:
        df[colName] = dfTest[colName]
        
    # Insert first and last columns ('id', 'category')
    df.insert(0, 'id', dfTest['id'])
    df['category'] = 0
    
    return df

# -----------------------------------------------------------------------------

trainFile = "c:/dev/source/python/work/bitbucket/malware/work/malware/2nd_iteration/datasets/single/train/win32_api_calls_1_filter_1.csv"
testFile = "c:/dev/source/python/work/bitbucket/malware/work/malware/2nd_iteration/datasets/single/test/win32_api_calls_1_filter_1.csv"

df = convertTestFilesToTrainFeaturesSpace(trainFile, testFile)

print df.head()